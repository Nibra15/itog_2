# Итоговая проверочная работа
Брадтке Никлас, к0111-23/24, вариант 1,1
Билет 1: Структура HTTP-запроса и её роль в маршрутизации

Методы запроса Методы HTTP определяют тип операции, которую клиент хочет выполнить над ресурсом: – GET: Получение данных. – POST: Создание нового ресурса. – PUT: Обновление существующего ресурса. – DELETE: Удаление ресурса. – PATCH: Частичное обновление ресурса. Методы запроса могут использоваться балансировщиками нагрузки для маршрутизации трафика. Например, можно настроить правила, направляющие GET-запросы на один сервер, а POST-запросы — на другой.

Request URI и Query String – Request URI: Указывает путь к ресурсу, например, /api/users. – Query String: Содержит параметры запроса, например, ?id=123&sort=asc. Балансировщики могут использовать URI и параметры запроса для маршрутизации. Например, запросы к /api/admin могут направляться на отдельный сервер, обслуживающий административный интерфейс.

Заголовки пакета  содержат метаинформацию о запросе: – Content-Type: Тип содержимого тела запроса. – Authorization: Данные для аутентификации. – User-Agent: Информация о клиентском приложении. Балансировщики могут использовать заголовки для маршрутизации. Например, можно настроить правила, направляющие запросы с определённым User-Agent на специфические серверы. Для балансировки могут использоваться заголовки пакета (не предусмотренные стандартом заголовки начинаются с X-. Например, X-My-Key). Недостаток такой балансировки - если балансировщик строго следует протоколу HTTP, то нужно обязательно соблюдать нейминг с X-***. Самая первая строка HTTP является служебной, там передаётся тип запроса, эндпоинт (куда мы отправляем запрос) и протокол передачи с версией. Внутри передаваемого TCP/UDP пакета имеется полезная нагрузка, данные, внутри которых могут использоваться другие пакеты (например HTTPпакет).

Тело запроса содержит данные, отправляемые на сервер, особенно в POST и PUT запросах. Балансировщики обычно не анализируют тело запроса из-за затратности этой операции. Однако в некоторых случаях, например, при использовании API Gateway, возможна маршрутизация на основе содержимого тела запроса.
Использование компонентов запроса для маршрутизации Балансировщики нагрузки и API Gateway могут использовать различные компоненты HTTP-запроса для принятия решений о маршрутизации: – Метод запроса: Например, направлять GET-запросы на кэширующие серверы. – URI и Query String: Маршрутизация на основе пути и параметров запроса. Заголовки: Использование заголовков для определения целевого сервера. Чтобы передать картинку при помощи HTTP, необходимо передать её в формат Base64. Base64 - формат данных для передачи, использующий только символы ASCII.

---

#### Демонстрационное задание

* Все исполняемые файлы расположены в папке ./bin
* Файлы Frontend-приложения расположены в папке ./frontend

---

!!! ВАЖНОЕ ЗАМЕЧАНИЕ:
В выражение **map** конфигурации NGINX необходимо добавить опцию **hostnames;**

Пример:
```
map $http_x_rpc_method $target_service {
   hostnames;

   user.*  user-service;
   default core-service;
}
```
---
1. В Docker Compose нужно сконфигурировать следующую инфраструктуру:
   * loadbalancer - роутер/балансировщик нагрузки
   * core-service - контейнер с запущенным сервисом ./bin/core-service
   * math-service - контейнер с запущенным сервисом ./bin/math-service

2. loadbalancer должен отвечать на запросы по адресу http://127.0.0.1:8080 (внутри контейнера сервис использует порт :80)

3. Сервисы __core-service__ и __math-service__ должны быть доступны только внутри Compose и принимать подключения на порту __:80__

4. Запрос по адресу __http://127.0.0.1:8080__ должен возвращать стартовую страницу frontend приложения. Файлы веб приложения расположены в папке ./frontend. Необходимо смонтировать эту папку в контейнер и настроить правило маршрутизации для __location /__

5. Запросы по адресу __http://127.0.0.1:8080/rpc__ должны возвращать результаты вызовов к микросервисам __core-service__ и __math-service__

6. Правила RPC протокола:
   * Максимальный размер пакета - 4096 байт
   * Время выполнения запроса - 1 секунда
   * Запросы только методом POST
   * В запросе должны присутствовать следующие заголовки:
     * X-Client-ID: sirius-frontend
     * X-Client-Secret: <любая строка>
     * X-Rpc-Method: <math.*>
   * Тело запроса должно приходить в формате JSON

7. Правила маршрутизации запросов для __location /rpc__
   * Все запросы удовлетворяющие правилу __math.*__ проксируются в сервис __math-service__
   * Все остальные запросы просируются в __core-service__
